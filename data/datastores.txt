.. _datadatastores:

Espaces de stockage
===================

.. contents:: Table des mati√®res
    :depth: 4
    :backlinks: top

Un espace de stockage contient des sources de donn√©es, locales ou
distantes. Il est d√©finit par un nom (sans accents, espace ou
caract√®res sp√©ciaux), ainsi que par diff√©rents param√®tres selon son
type. Il existe quatre types d'espaces de stockage dans MapMint:

.. |adddb| image:: ../_static/images/database.png
   :height: 24
   :alt: PDF icon

.. |adddir| image:: ../_static/images/directory.png
   :height: 24
   :alt: PDF icon

.. |addwfs| image:: ../_static/images/ogcserver.png
   :height: 24
   :alt: PDF icon
   
============ ================== ============================================
**Ic√¥ne**    **Type** 		    **Action**       
------------ ------------------ --------------------------------------------
|adddb|      Base de donn√©es    Ajout d'une connexion √† une base de donn√©es 	           
|adddir|     R√©pertoire         Ajout d'un r√©pertoire de donn√©es 			 
|addwfs| 	 Serveur OGC 	 	Ajout d'un serveur OGC externe 	          
============ ================== ============================================							

.. warning::
   Le nom d'un espace de stockage ne doit contenir ni *espace*, *accent* ou *caract√®res sp√©ciaux*

.. _datadatastores_add:

Ajouter un espace de stockage
*****************************

R√©pertoires
-------------

Un espace de stockage de type r√©pertoire permet d'√©tablir un lien
symbolique vers un r√©pertoire de donn√©es du serveur FTP. Cliquez sur
l'ic√¥ne "Ajouter un r√©pertoire" se trouvant dans la barre
d'outils. Cela entraine l'affichage du formulaire d'ajout d'un
r√©pertoire.

.. |adddirw| image:: ../_static/images/add-directory-window.png
	:width: 100%
	:alt: add directory window

|adddirw|

Renseignez le nom de l'espace de stockage puis s√©lectionnez un
r√©pertoire du serveur dans l'arbre des r√©pertoires (arborescence du
rep√©rtoire /data de l'instance MapMint). Vous avez la possibilit√© de
cr√©er un r√©pertoire vide sur le serveur FTP, en choisissant l'option
"nouveau", vous devez alors aussi donner un nom au r√©pertoire √†
cr√©er.

.. warning::
   Le r√©pertoire cibl√© ne doit pas contenir de sous-r√©pertoires.
   
.. warning::
   Le repertoire cibl√© doit contenir uniquement des formats de donn√©es support√©s par MapMint.

Cela entra√Æne la fermeture de la fen√™tre et l'ajout du nouvel espace de stockage dans l'abre de gauche, dans la section R√©pertoires.

.. note::
   Une fois l'espace de stockage cr√©e, proc√©der √† un clic droit sur ce dernier et cliquer sur "Rafraichir".
   
Le clic sur l'espace de stockage entraine l'affichage des sources de donn√©es qu'il contient dans le panneau des :doc:`datasources`.
   
Base de donn√©es
-------------------------------

Un espace de stockage de type base de donn√©es permet d'√©tablir une
connexion avec une base de donn√©es PostgreSQL ou MySQL. Cliquez sur
l'ic√¥ne "Ajouter une base de donn√©es" se trouvant dans la barre
d'outils en haut du panneau des espaces de stockages. Cela entraine
l'affichage du formulaire d'ajout d'une connexion √† une base de donn√©es
comme illustr√© ci-dessous.

.. |adddbw| image:: ../_static/images/add-database-window.png
	:width: 100%
	:alt: add database window

|adddbw|

Renseignez tous les champs puis cliquez sur le bouton "Tester". 

Si le test renvoie un message de succ√®s, vous pouvez alors cliquer sur le bouton "Ajouter". Cela entra√Æne la fermeture de la fen√™tre et l'ajout du nouvel espace de stockage dans l'abre de gauche, dans la section PostGIS ou MySQL.

.. note::
   Une fois l'espace de stockage cr√©e, cliquez sur ce dernier dans le
   menu de gauche pour le voir se charger dans la partie de droite
   comme pr√©sent√© sur la capture d'√©cran pr√©c√©dente.
   
Le clic sur l'espace de stockage entraine son affichage dans la
partie de droite.

Serveurs OGC
---------------

Un espace de stockage de type serveur OGC permet d'√©tablir une
connexion √† un serveur WMS ou WFS externe. Cliquez sur l'ic√¥ne
"Ajouter un serveur OGC" se trouvant dans la barre d'outils, cela
entraine l'affichage du formulaire d'ajout d'un serveur OGC.

.. |addwfsw| image:: ../_static/images/add-ogcserver-window.png
	:width: 100%
	:alt: add database window

|addwfsw|

Renseignez le nom de l'espace de stockage, l'URL du serveur OGC cibl√©
ainsi que le protocole √† utiliser (WMS ou WFS), puis cliquez sur le
bouton "Tester". 

Si le test renvoie un message de succ√®s, vous pouvez alors cliquer sur le bouton "Ajouter". Cela entra√Æne la fermeture de la fen√™tre et l'ajout du nouvel espace de stockage dans l'arbre de gauche, dans la section Serveur WFS.

Le clic sur l'espace de stockage entraine l'affichage des couches OGC du serveur externe.

Acc√©der √† un espace de stockage
*******************************

Lorsque vous cliquez sur l'espace de stockage cela entraine son
affichage comme illstr√© ci-dessous.

.. |dsp| image:: ../_static/images/data-store-preview.png
	:width: 100%
	:alt: add database window

|dsp|

Les espaces de stockage offrent des fonctions sp√©cifiques suivant leur
type, l'ensemble des boutons de la barre d'outils correspondante √† un
espace de stockagre est pr√©sent√© ci-dessous. Pour chaque bouton, le
type d'espace de stockage depuis lequel la fonctionnalit√© est
accessible est aussi mise en √©vidence.

.. |select| image:: ../_static/images/select.png
   :height: 24

.. |moz| image:: ../_static/images/tile.png
   :height: 24

.. |share| image:: ../_static/images/share.png
   :height: 24

.. |db| image:: ../_static/images/database.png
   :height: 24

.. |download| image:: ../_static/images/download.png
   :height: 24

.. |upload| image:: ../_static/images/upload.png
   :height: 24

.. |tile| image:: ../_static/images/tile.png
   :height: 24

.. |privileges| image:: ../_static/images/privileges.png
   :height: 24

.. |conf| image:: ../_static/images/configuration.png
   :height: 24

.. |delete| image:: ../_static/images/delete.png
   :height: 24

.. |refresh| image:: ../_static/images/refresh.png
   :height: 24

.. |toggle| image:: ../_static/images/toggle1.png
   :height: 24

.. |close| image:: ../_static/images/close.png
   :height: 24

Barre d'outils d'un espace de stockage
--------------------------------------

============ ==================== ============================================
**Ic√¥ne**    **Accessible** 		    **Action**       
------------ -------------------- --------------------------------------------
|select|      Tous                Selectionnez toutes les sources de donn√©es contenues 	           
|moz|         R√©pertoire          Cr√©er une mosa√Øc d'images (requiert une source de donn√©es image s√©lectionn√©e)
|download| 	 R√©pertoire 	          T√©l√©charge les sources de donn√©es s√©lectionn√©es (requiert une source de donn√©es image s√©lectionn√©e)
|share| 	 Tous 	 	  Ouvrir les sources de donn√©es selectionn√©es dans le :ref:`maps` (requiert une source de donn√©es s√©lectionn√©e) 			 
|db| 	         Base de donn√©es  Acc√©der √† la base de donn√©es
|upload| 	 R√©pertoire 	          Envoyez une source de donn√©es dans l'espace de stockage du serveur
|tile| 	           R√©pertoire     Cr√©er un index de tuiles dans l'espace de stockage
|privileges| 	 Toute 	          Gestion des droits d'acc√©s d'un espace de stockage 	          
|conf|           Tout 	          Param√©trage de l'espace de stockage	          
|delete| 	 Tous 	          Supprimer l'espace de stockage       
|refresh| 	 Tous 	          Rafraichir l'espace de stockage 	          
|toggle| 	 Tous 	          Afficher / masquer l'espace de stockage 	          
|close| 	 Tous 	          Fermer l'espace de stockage
============ ==================== ============================================							

Cr√©er une mosa√Øque d'images
---------------------------

La cr√©ation d'une mosa√Øque d'images permet
de fusionner plusieurs sources de donn√©es images en une seule.

Lorsque vous cliquez sur le boutton "Cr√©er une moza√Øc d'images" le
formulaire pr√©sent√© ci-desous s'affiche. Une fois que vous avez
renseign√© le nom de la mosa√Øque √† cr√©er, cliquez sur le bouton
"Mosa√Øque" pour le g√©n√©rer. 

.. warning::

    Cette op√©ration peut prendre du temps suivant les sources de
    donn√©es images s√©lectionn√©es.

.. |dsm| image:: ../_static/images/data-store-mozaic.png
	:width: 100%
	:alt: Cr√©er une moza√Øque une image

|dsm|

Envoyer une source de donn√©es dans un espace de stockage
--------------------------------------------------------

Vous pouvez utiliser le panneau d'un espace de stockage pour y envoyer
un fichier de donn√©es g√©ographique que vous avez sur votre machine
locale. Ceci se fait √† l'aide du formulaire pr√©sent√© ci-dessous.

Vous pouvez alors cliquer sur le boutton "Parcourir" afin d'ajouter
vos fichiers √† la liste des fichiers √† envoyer.

.. warning::

    Bien que la fonctionnalit√© d'envoi de sources de donn√©es soit
    disponible sur la plateforme MapMint, elle ne devrait √™tre
    utilis√©e que pour des sources de donn√©es ne d√©passant pas 10Mo.

.. |dsu| image:: ../_static/images/data-store-upload.png
	:width: 100%
	:alt: Envoyer une source de donn√©es sur le serveur

|dsu|


Cr√©er un index de tuiles dans un espace de stockage
---------------------------------------------------

Lorsque que l'on souhaite publier des sources de donn√©es images de
type photo a√©riennes par exemple, il est n√©cessaire d'utiliser un
index de tuiles. Un index de tuiles est une source de donn√©es vecteurs
(de type polygone) o√π chaque polygon repr√©sente la zone g√©ographique
couverte par une source de donn√©es images (une photos a√©rienne par
exemple) et a une seule propri√©t√© qui est le chemin complet vers le
fichier image.

Pour cr√©er un index de tuiles, vous devez placer un r√©pertoire
contenant l'ensemble des photos √† partir desquelles vous souhaitez
cr√©er un index de tuiles. Une fois ceci fait, vous pouvez cliquer sur
le boutton "Cr√©er un index de tuiles" de l'espace de stockage dans
lequel vous souhaitez le stocker, le formulaire pr√©sent√© ci-dessous
apparait. S√©lectionnez le SRS de l'index √† cr√©er, saisissez
l'extension des fichiers √† utiliser (tif par exemple) puis cochez le
r√©pertoire stockant vos photos, cliquez ensuite sur le boutton "Index
de tuiles" pour g√©n√©rer l'index de tuiles.

.. |dt| image:: ../_static/images/data-tileindex.png
	:width: 100%
	:alt: View datasource histogram

|dt|


Gestion des droits d'acc√©s d'un espace de stockage
--------------------------------------------------

Une source de donn√©es est accessible √† tous les groupes d'utilisateurs
par d√©faut. Pour modifier les permissions l'acc√®s √† une couche,
veuillez cliquer sur l'icone correspondante dans la
:ref:`datasource-table-label`. Cel√† entra√Æne l'affichage du formulaire
de gestion de droits d'acc√®s, illustr√© ci-dessous.

.. |setp| image:: ../_static/images/data-privileges.png
	:width: 100%
	:alt: View datasource histogram

|setp|

Les droits que vous pouvez affecter √† un groupe d'utilisateurs sont
list√©s dans la table suivante.

========== ============================================
**Valeur**  **D√©finition**       
---------- --------------------------------------------
r          Le groupe d'utilisateurs √† acc√®s √† l'espace de stockage en lecture
w          Le groupe d'utilisateurs √† acc√®s √† l'espace de stockage en √©criture
x          Le groupe d'utilisateurs √† le droit d'ex√©cuter des services dans l'espace de stockage			           	  	           
========== ============================================

Ajoutez un ou plusieur groupes avec le bouton "Ajouter", cela entraine
l'ajout de listes d√©roulantes dans la fen√™tre. Ajustez les valeurs
**r**, **w** et **x** puis cliquer sur le bouton "Valider". Le
formulaire disparait et l'enregistrement des modifications est r√©alis√©.

Si vous cliquez sur le boutton "Supprimer" vous pouvez supprimer la
derni√®re ligne de d√©finition de privil√®ges d'acc√®s.

Pour voir le droit de lister le contenu d'un espace de stockage un
groupe d'utilisateurs doit avoir les droits **r** et **x**. Pour
pouvoir cr√©er de nouvelles sources de donn√©es dans l'espace de
stockage, un groupe doit avoir le droit **w**.

Param√©trage d'un espace de stockage
--------------------------------------------------

Le formulaire de param√©trage d'un espace de stockage et √©quivalent au
formulaire d'ajout sp√©cifique au type d'espace de stockage vu
:ref:`pr√©c√©demment <datadatastores_add>`.

Supprimer un espace de stockage
--------------------------------------------------

Si vous cliquez sur le boutton "Supprimer l‚Äôespace de stockage", une
fen√™tre apparait vous invitant √† confirmer votre volontÈ de supprimer
un espace de stockage. La suppression d'un espace de stockage peut
entrainer des pertes de donn√©es graves et impliquer que l'application
grand publique devienne instable du fait de l'indisponibilit√© de
certaines sources de donn√©es n√©cessaires. Il est donc imp√©ratif de
s'assurer qu'aucun projet ne d√©pend de donn√©es pr√©sentes dans l'espace
de stockage que vous souhaitez supprimer avant de le faire. Si vous
souhaitez vraiment supprimer un espace de stockage, cliquez alors sur
le bouton "Oui" de la fen√™tre vous informant des implications
de la suppression.

Rafraichir un espace de stockage
--------------------------------------------------

Lors du premier acc√®s √† un espace de stockage, MapMint cr√©e un fichier
Mapfile sp√©cifique √† MapServer qui permet la diffusion des sources de
donn√©es contenues. Une fois ce fichier cr√©√©, il n'est plus
modifi√©. Cela implique que si vous avez ajout√©, supprim√© ou cr√©√©e une
nouvelle source de donn√©es dans un espace de stockage, vous devrez
utilisez le boutton de rafraichissement permettant d'obtenir une liste
exhaustive des sources de donn√©es contenues dans un espace de
stockage. Lorsque vous cliquez sur le boutton de rafraichissement, le
contenu de l'espace de stockage est mis √† jour.
